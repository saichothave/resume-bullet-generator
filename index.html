<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Resume Parser</title>
</head>

<body class="bg-gray-900 text-white min-h-screen">
  <div class="relative isolate overflow-hidden">
    <!-- Background Decoration -->
    <svg class="absolute inset-0 -z-10 h-full w-full stroke-white/10" aria-hidden="true">
      <defs>
        <pattern id="pattern-bg" width="200" height="200" patternUnits="userSpaceOnUse">
          <path d="M.5 200V.5H200" fill="none" />
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#pattern-bg)" stroke-width="0" />
    </svg>

    <div class="mx-auto max-w-screen-xl px-4 py-12 lg:flex lg:gap-16 lg:items-start">
      <div class="flex-1 min-w-0">
        <img class="h-11 mb-6" src="cantileverwhitelogo.png" alt="Logo">
        <h1 class="text-3xl font-bold sm:text-4xl">Resume Bullet & Interview Prep Assistant</h1>
        <p class="mt-6 text-gray-300">Paste your experience story and get a powerful resume bullet and related questions instantly.</p>

        <!-- Form -->
        <div class="mt-8">
          <textarea id="storyInput" rows="5" class="w-full rounded-md p-3 text-black mb-4" placeholder="Paste your experience story here..."></textarea>
          <textarea id="instructionsInput" rows="2" class="w-full rounded-md p-3 text-black mb-4" placeholder="Optional: Add instructions like 'Make it technical' or 'Add more metrics'..."></textarea>
          <button onclick="generateBullet()" class="w-full rounded-xl bg-blue-500 hover:bg-blue-600 py-2.5 text-white font-semibold">Generate Resume Bullet & Questions</button>
        </div>

        <!-- Loader -->
        <div class="text-yellow-300 mt-4 hidden" id="loader">
          <i class="fas fa-star animate-spin"></i> Generating response on local server. Thank you for your patience...
        </div>

        <!-- Output Section -->
        <div class="mt-8 bg-white text-black p-6 rounded-xl">
          <h3 class="text-xl font-semibold">ðŸŒŸ Resume Bullet</h3>
          <div id="bulletOutput" class="mt-2">...</div>

          <h3 class="text-xl font-semibold mt-6">ðŸ’¬ Suggested Interview Questions</h3>
          <div id="questionList" class="mt-2 ps-4"></div>
        </div>

        <!-- Chat Section -->
        <div id="chatSection" class="mt-10 hidden">
          <h3 class="text-xl font-semibold">ðŸ’¡ Ask AI: Prepare Smarter</h3>
          <div id="chatBox" class="mt-2 h-48 overflow-y-auto bg-gray-100 text-black p-3 rounded-md"></div>
          <input type="text" id="userChatInput" class="w-full mt-2 p-2 text-black rounded-md" placeholder="Ask a question about your bullet...">
          <button onclick="sendToChat()" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white py-1.5 px-4 rounded-md">Ask AI</button>
        </div>
      </div>

      <!-- Right Illustration -->
      <div class="flex-shrink-0 mt-12 lg:mt-0 w-full lg:w-[20%]">
        <img src="scan.gif" alt="Illustration" class="w-full rounded-lg shadow-xl" />
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-6 text-sm text-gray-400">
      Created for live demo by @saichothave &middot; Cantilever Labs
    </footer>
  </div>

  <!-- Scripts from Original HTML (JS kept unchanged) -->
  <script>
    let contextStory = "";
    let contextBullet = "";
    let contextQuestions = "";

    async function generateBullet() {
      const story = document.getElementById("storyInput").value;
      const instructions = document.getElementById("instructionsInput").value;
      const loader = document.getElementById("loader");
      const bulletOutput = document.getElementById("bulletOutput");
      const questionList = document.getElementById("questionList");

      loader.style.display = "block";
      bulletOutput.innerText = "...";
      questionList.innerHTML = "";
      document.getElementById("chatSection").style.display = "none";
      document.getElementById("chatBox").innerHTML = "";

      const response = await fetch("http://127.0.0.1:8000/generate", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ story, instructions })
      });

      const data = await response.json();

      contextStory = story;
      contextBullet = data.bullet.trim();
      contextQuestions = data.questions.trim();

      loader.style.display = "none";

      const bulletHTML = data.highlighted_bullet.trim().split("\n")
        .filter(line => line.trim().startsWith("*"))
        .map(line => `<li>${line.replace(/^\*\s*/, '').replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")}</li>`)
        .join("");

      bulletOutput.innerHTML = `<ul class='list-disc ps-4'>${bulletHTML}</ul>`;

      data.questions.trim().split("\n").forEach(q => {
        if (q.trim()) {
          const div = document.createElement("div");
          div.innerText = q.trim();
          questionList.appendChild(div);
        }
      });

      document.getElementById("chatSection").style.display = "block";
      addChatMessage("bot", "You can now ask me anything about your bullet to prepare smarter.");
    }

    async function sendToChat() {
      const userInput = document.getElementById("userChatInput").value.trim();
      if (!userInput) return;

      addChatMessage("user", userInput);
      document.getElementById("userChatInput").value = "";

      const response = await fetch("http://127.0.0.1:8000/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          story: contextStory,
          bullet: contextBullet,
          questions: contextQuestions,
          user_query: userInput
        })
      });

      const lines = data.split('\n');

      const refined_data = lines
        .filter(line => line.trim().startsWith("*"))
        .map(line =>
          `<li>${line.replace(/^\*\s*/, '').replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")}</li>`
        )
        .join("");

      addChatMessage("bot", refined_data);
    }

    function addChatMessage(sender, text) {
      const msg = document.createElement("div");
      msg.classList.add("chat-message", sender);
      msg.innerHTML = text;
      const chatBox = document.getElementById("chatBox");
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</body>

</html>
